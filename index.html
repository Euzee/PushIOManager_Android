<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Push IO Manager by pushio</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Push IO Manager</h1>
        <p>Android Integration Guide</p>

        <p class="view"><a href="https://github.com/pushio/PushIOManager_Android">View the Project on GitHub <small>pushio/PushIOManager_Android</small></a></p>


        <ul>
          <li><a href="https://github.com/pushio/PushIOManager_Android/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/pushio/PushIOManager_Android/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/pushio/PushIOManager_Android">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p><img src="http://push.io/wp-content/uploads/2012/05/pushio_logo.png" alt="Push IO®"></p>

<p>Copyright © 2009 - 2013 Push IO Inc. All Rights Reserved.<br>
Push IO® is a registered trademark in the United States. All other trademarks are the property of their respective owners.</p>

<h4>Software License Information</h4>

<p>The use of any and all Push IO software regardless of release state is governed by the terms of a Software License Agreement and Terms of Use that are not included here but required by reference.</p>

<h4>Privacy Information</h4>

<p>The use of Push IO services is subject to various privacy policies and restrictions on the use of end user information. For complete information please refer to your Master Agreement, our website privacy policies, and/or other related documents.</p>

<h4>Billing</h4>

<p>For information on your account and billing, please contact <a href="mailto:sales@push.io">sales@push.io</a></p>

<h4>Contact Info</h4>

<p>Push IO
1035 Pearl Street, Suite 400
Boulder, CO 80302 USA
303-335-0903
<a href="mailto:support@push.io">support@push.io</a>
<a href="http://www.push.io">www.push.io</a></p>

<h2>Preface</h2>

<p>Push IO is a leading provider of real-time push notification alerts and mobile data delivery.This document provides the necessary information to leverage Push IO for your mobile application. This document corresponds to the latest version of PushIOManager for Android.</p>

<h2>Definitions</h2>

<h4>UUID</h4>

<p>A unique identifier corresponding to a specific device that is used to register with the Push IO service.</p>

<h4>Category</h4>

<p>A category defines a specific content type that your app has which users might be interested in. For example, if your app is a sports app, a category may be a specific team.</p>

<h4>Audience</h4>

<p>An audience defines a group of users based on one or more categories or platforms. For example, you might make an audience out of all of the users who have registered to a category for a team in the Western Conference who are using your app on Android.</p>

<h4>Test Device</h4>

<p>A device specially registered with Push IO to help you troubleshoot, test, and preview push notifications.</p>

<h2>App Integration</h2>

<h4>Overview</h4>

<p>Push IO provides a lightweight PushIOManager library for each supported platform.</p>

<p>The library provides simple methods for registering so Push IO can send push notifications to a device via the platform gateway. The library also provides interfaces for segmenting your users into groups called categories. This allows you to send targeted push notifications only to those users who have expressed an interest in <em>bird watching</em>, and then perhaps only users who are interested in <em>robins</em>.</p>

<p>Push IO is the only push notification provider which provides data that allows you to understand how push notification engagement leads your users to high-value actions like in-app purchases, premium content viewing, and more. The PushIOManager library provides a simple mechanism to capture this push conversion information, which is available to you via the <a href="https://manage.push.io">Push IO Manager</a> dashboard.</p>

<h4>Integration Prerequisites</h4>

<p>Before continuing, be sure you have what you need to integrate Push IO into your app.</p>

<ol>
<li>Sign Up for a Push IO account at <a href="https://manage.push.io">https://manage.push.io</a>
</li>
<li>Download our Push IO Mobile Dashboard app to easily send your first push!</li>
<li>Obtain a service ID and API key for Google's <a href="http://developer.android.com/guide/google/gcm/gs.html">GCM</a> service</li>
<li>Setup your app and add an Android platform at <a href="https://manage.push.io">https://manage.push.io</a>
</li>
<li>Downloaded PushIOManager for Android and pushio_config.json from <a href="https://manage.push.io">Set Up &gt; Android</a>
</li>
</ol><p><img src="http://pushiocdn.s3.amazonaws.com/docs_assets/platformdetail_android.png" alt="Platform download"></p>

<p>All set? Now you’re ready to integrate Push IO into your app!</p>

<h2>PushIOManager for Android</h2>

<p>In order to add the PushIOManager JAR to your Android application, follow these simple steps:</p>

<h3>Locate the two files you downloaded from Set Up &gt; Android from the Push IO Manager dashboard.</h3>

<p><img src="http://pushiocdn.s3.amazonaws.com/docs_assets/files_android.png" alt="Downloads"></p>

<h3>Add the PushIOManager.jar to your project’s libs folder.</h3>

<h3>Drag pushio_config.json file to your project's assets folder.</h3>

<h3>Now you need to set up your Android Manifest.</h3>

<p>The following user-permissions are required to use Google Cloud Messaging (replace com.example with your application namespace).</p>

<div class="highlight"><pre><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"com.example.permission.C2D_MESSAGE"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"com.google.android.c2dm.permission.RECEIVE"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WAKE_LOCK"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;permission</span> <span class="na">android:name=</span><span class="s">"com.example.permission.C2D_MESSAGE"</span> <span class="na">android:protectionLevel=</span><span class="s">"signature"</span> <span class="nt">/&gt;</span>
</pre></div>

<p>In the Android Manifest under the “application” tag you need to set up the PushIOBroadcastReceiver. (Once again replace com.example for your application namespace.)</p>

<p><em>Even though Google has moved from C2DM to CCM the permissions still use the c2dm name for backward compatibility with older devices.</em></p>

<div class="highlight"><pre><span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">"com.pushio.manager.PushIOBroadcastReceiver"</span> <span class="na">android:permission=</span><span class="s">"com.google.android.c2dm.permission.SEND"</span> <span class="nt">&gt;</span>
<span class="nt">&lt;intent-filter&gt;</span>
<span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.android.c2dm.intent.RECEIVE"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.android.c2dm.intent.REGISTRATION"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"com.example"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/receiver&gt;</span>

<span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">"com.pushio.manager.PushIOActivityLauncher"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;service</span> <span class="na">android:name=</span><span class="s">"com.pushio.manager.PushIOGCMIntentService"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;service</span> <span class="na">android:name=</span><span class="s">"com.pushio.manager.PushIOEngagementService"</span><span class="nt">/&gt;</span>
</pre></div>

<h3>Call ensureRegistration() when the application is first starting.</h3>

<p>This will ensure that registration is maintained between upgrades of the application. </p>

<div class="highlight"><pre><span class="n">PushIOManager</span> <span class="n">pushIOManager</span> <span class="o">=</span>
<span class="k">new</span> <span class="nf">PushIOManager</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="n">pushIOManager</span><span class="o">.</span><span class="na">ensureRegistration</span><span class="o">();</span>
</pre></div>

<h3>Register with Push IO</h3>

<p>You can register a device with Push IO one of two ways. First, if your application gives users a way to specify a preference or favorite, you may want to register for that category you can you push to them relevant content. Note that the PushIOManager has two callbacks that can be optionally implemented that allow you to deal with success and errors. Additionally success and error is logged under the “pushio” tag.</p>

<p>This kind of registration would be tied to a notification UI, allowing the user to select categories.</p>

<div class="highlight"><pre><span class="c1">// Register for US and World Headlines</span>
<span class="n">PushIOManager</span> <span class="n">pushIOManager</span> <span class="o">=</span>
<span class="k">new</span> <span class="nf">PushIOManager</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
<span class="n">categories</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"US"</span><span class="o">);</span>
<span class="n">categories</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"World"</span><span class="o">);</span>
<span class="n">pushIOManager</span><span class="o">.</span><span class="na">registerCategories</span><span class="o">(</span> <span class="n">categories</span><span class="o">,</span> <span class="kc">false</span> <span class="o">);</span>
</pre></div>

<div class="highlight"><pre><span class="c1">// Unregister for US Headlines</span>
<span class="n">PushIOManager</span> <span class="n">pushIOManager</span> <span class="o">=</span>
<span class="k">new</span> <span class="nf">PushIOManager</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
<span class="n">categories</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"US"</span><span class="o">);</span>
<span class="n">pushIOManager</span><span class="o">.</span><span class="na">unregisterCategories</span><span class="o">(</span> <span class="n">categories</span><span class="o">,</span> <span class="kc">false</span> <span class="o">);</span>
</pre></div>

<p>If you just want to be able to broadcast to all your users at once, you can simple call ensureRegistration (on application startup). To unregister a device simply call unregisterDevice.</p>

<div class="highlight"><pre><span class="c1">// Unregister device</span>
<span class="n">PushIOManager</span> <span class="n">pushIOManager</span> <span class="o">=</span>
<span class="k">new</span> <span class="nf">PushIOManager</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="n">pushIOManager</span><span class="o">.</span><span class="na">unregisterDevice</span><span class="o">();</span>
</pre></div>

<h3>Handle Push</h3>

<p>In Android push notifications are broadcast using the action “com.example.PUSHIOPUSH”, if you don’t handle this broadcast the Push IO Manager will create a standard notification for you (using the badge name and sound name to to gather the proper resources from your application assets. If you don’t need anything fancy you can skip this section and move down to “Handling Push Intents”.</p>

<p>For custom notification you need to register a broadcast receiver in your android manifest. </p>

<div class="highlight"><pre>        <span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">"com.example.NotificationBroadcastReceiver"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span>  <span class="na">android:name=</span><span class="s">"com.example.PUSHIOPUSH"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/receiver&gt;</span> 
</pre></div>

<p>From this broadcast receiver you can direct the push anywhere you would like, a common practice is to create an intent service that creates the notification. It is important that this broadcast receiver registers with the Push IO Manager that it is handling the notification so the Push IO Manager doesn’t create a duplicate notification. </p>

<div class="highlight"><pre>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">CustomNotificationService</span><span class="o">.</span><span class="na">runIntentInService</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">intent</span><span class="o">);</span>
        <span class="n">Bundle</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">getResultExtras</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">extras</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="n">PushIOManager</span><span class="o">.</span><span class="na">PUSH_STATUS</span><span class="o">,</span> <span class="n">PushIOManager</span><span class="o">.</span><span class="na">PUSH_HANDLED_NOTIFICATION</span><span class="o">);</span>
        <span class="n">setResultExtras</span><span class="o">(</span><span class="n">extras</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>

<p>It is recommended that you use the PushIOActivityLauncher for the pending activities of your notifications. Using this class will automatically handle push engagement tracking for you. The PushIOActivityLauncher expects you to pass the notification intent (from the broadcast receiver) as extras. </p>

<div class="highlight"><pre>            <span class="n">Intent</span> <span class="n">newIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">PushIOActivityLauncher</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">newIntent</span><span class="o">.</span><span class="na">putExtras</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
            <span class="n">PendingIntent</span> <span class="n">lPendingIntent</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">newIntent</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</pre></div>

<p>In certain activities in your application you may not want to show status bar notifications, but instead handle the push in-app. The best way to do this is to register a broadcast receiver on the onResume() of your activity, and unregister the receiver on the activitie's onPause().  The following example creates a local broadcast receiver, handles the push, and tells the Push IO Manager that the push was handled “in-app”. This will automatically track the in-app engagement and prevent the Push IO Manager from creating a custom notification. this.abortBroadcast() is used to stop the broadcast from hitting the application wide “NotificationBroadcastReceiver”. </p>

<div class="highlight"><pre><span class="n">mBroadcastReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">alert</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"alert"</span><span class="o">);</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">lContext</span><span class="o">,</span> <span class="n">alert</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>

                <span class="n">Bundle</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">getResultExtras</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                <span class="n">extras</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="n">PushIOManager</span><span class="o">.</span><span class="na">PUSH_STATUS</span><span class="o">,</span> <span class="n">PushIOManager</span><span class="o">.</span><span class="na">PUSH_HANDLED_IN_APP</span><span class="o">);</span>
                <span class="n">setResultExtras</span><span class="o">(</span><span class="n">extras</span><span class="o">);</span>
                <span class="k">this</span><span class="o">.</span><span class="na">abortBroadcast</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">registerReceiver</span><span class="o">(</span> <span class="n">mBroadcastReceiver</span><span class="o">,</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">"com.pushio.dashboard.PUSHIOPUSH"</span><span class="o">)</span> <span class="o">);</span>
</pre></div>

<p>On the onPause() call:</p>

<div class="highlight"><pre>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">(){</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>

        <span class="n">unregisterReceiver</span><span class="o">(</span><span class="n">mBroadcastReceiver</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>

<h3>Handling Notification Pressed Intents</h3>

<p>When a notification is pressed and is using the PushIOActivityLauncher an intent is launched for the action "com.example.NOTIFICATIONPRESSED". To handle this action you need to register an intent filter in your AndroidManaifest.xml</p>

<div class="highlight"><pre><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">"com.example.myactivity"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.example.NOTIFICATIONPRESSED"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</pre></div>

<p>Congratulations, that's all there is to it! You should now be ready to test your Android integration.</p>

<h3>Advanced Engagements</h3>

<p>"Launch" and "Active Session" engagements are handled for you. To track other engagements you need to call trackEngagement, passing one of the "PUSHIO_ENGAGEMENT_METRIC" constants found in the PushIOManager. </p>

<div class="highlight"><pre>        <span class="n">pushIOManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PushIOManager</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">pushIOManager</span><span class="o">.</span><span class="na">ensureRegistration</span><span class="o">();</span>
        <span class="n">pushIOManager</span><span class="o">.</span><span class="na">trackEngagement</span><span class="o">(</span><span class="n">PushIOManager</span><span class="o">.</span><span class="na">PUSHIO_ENGAGEMENT_METRIC_PREMIUM_CONTENT</span><span class="o">);</span>
</pre></div>

<p>When the session is ending it is important to clear the EngagementId. </p>

<div class="highlight"><pre>        <span class="n">PushIOManager</span> <span class="n">pushIOManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PushIOManager</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">pushIOManager</span><span class="o">.</span><span class="na">resetEID</span><span class="o">();</span>
</pre></div>

<p>If you need further assistance, please visit our <a href="http://pushio.zendesk.com">support site</a>.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/pushio">pushio</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-16817212-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>